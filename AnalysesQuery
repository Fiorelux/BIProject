SET LINESIZE 2000;

SELECT TRADER, 
      SUM(ORDERSIZE) AS "TOTAL ORDERSIZE PER TRADER", 
      COUNT(ORDERSIZE) AS "NUMBER OF ORDERs PER TRADER", 
      ROUND(AVG(ORDERSIZE),0) AS "AVERAGE ORDERSIZE"    
	FROM MKTORDER
  GROUP BY TRADER
  ORDER BY SUM(ORDERSIZE) ASC;
 
SELECT TO_CHAR(mkt.ORDERTIME, 'HH24:MI:SS')
FROM MKTORDER mkt;

SELECT cmp.TICKER,
		SUM(mkt.ORDERSIZE) AS "TOTAL ORDERSIZE PER COMPANY",
		COUNT(mkt.ORDERSIZE) AS "NUMBER OF ORDERs PER COMPANY",
		AVG(mkt.ORDERSIZE) AS "AVERAGE ORDERSIZE PER COMP"
	FROM MKTORDER mkt, COMPANY cmp
    WHERE cmp.TICKER = mkt.TICKER
    GROUP BY cmp.TICKER;
	  

SELECT cmp.COMMONNAME,
		AVG(mkt.Price) AS "avg price for buy",
		AVG(mkt2.Price) AS "avg price for sell"
	FROM MKTORDER mkt, COMPANY cmp
	WHERE mkt.BS = B
	GROUP BY cmp.COMMONNAME
	HAVING cmp.Ticker = mkt.TICKER;

SELECT mkt.TRADER AS "Trader",
		COUNT(mkt.Ticker) AS "Company"
	FROM MKTORDER mkt
	GROUP BY mkt.TRADER;
	
SELECT cmp.Sector,
		AVG(mkt.OrderSize) AS "avg order size per parentsector",
	FROM COMPANY cmp, MKTORDER mkt
	WHERE cmp.Ticker = mkt.Ticker
	GROUP BY x.ParentSTR;
	
	
SELECT  mkt.trader,
        SUM(CASE WHEN mkt.ticker='ORCL' THEN 1 ELSE 0 END) AS "ORACLE trades per trader",
        SUM(CASE WHEN mkt.ticker='ADBE' THEN 1 ELSE 0 END) AS "ADOBE trades per trader",
        SUM(CASE WHEN mkt.ticker='DELL' THEN 1 ELSE 0 END) AS "DELL trades per trader",
        SUM(CASE WHEN mkt.ticker='EBAY' THEN 1 ELSE 0 END) AS "EBAY trades per trader",
        SUM(CASE WHEN mkt.ticker='CSCO' THEN 1 ELSE 0 END) AS "CSCO trades per trader",
        SUM(CASE WHEN mkt.ticker='SUNW' THEN 1 ELSE 0 END) AS "SUNW trades per trader",
        SUM(CASE WHEN mkt.ticker='AMZN' THEN 1 ELSE 0 END) AS "AMZN trades per trader",
        SUM(CASE WHEN mkt.ticker='MSFT' THEN 1 ELSE 0 END) AS "MSFT trades per trader",
        SUM(CASE WHEN mkt.ticker='AAPL' THEN 1 ELSE 0 END) AS "AAPL trades per trader",
        SUM(CASE WHEN mkt.ticker='YHOO' THEN 1 ELSE 0 END) AS "YHOO trades per trader"
      FROM MKTORDER mkt
      GROUP BY mkt.trader
      ORDER BY mkt.trader ASC;
      
     
     
      
SELECT  mkt.trader,
        (SUM(CASE WHEN mkt.ticker='ORCL' THEN 1 ELSE 0 END)/tt.total) AS "ORACLE trades per trader",
        SUM(CASE WHEN mkt.ticker='ADBE' THEN 1 ELSE 0 END) AS "ADOBE trades per trader",
        SUM(CASE WHEN mkt.ticker='DELL' THEN 1 ELSE 0 END) AS "DELL trades per trader",
        SUM(CASE WHEN mkt.ticker='EBAY' THEN 1 ELSE 0 END) AS "EBAY trades per trader",
        SUM(CASE WHEN mkt.ticker='CSCO' THEN 1 ELSE 0 END) AS "CSCO trades per trader",
        SUM(CASE WHEN mkt.ticker='SUNW' THEN 1 ELSE 0 END) AS "SUNW trades per trader",
        SUM(CASE WHEN mkt.ticker='AMZN' THEN 1 ELSE 0 END) AS "AMZN trades per trader",
        SUM(CASE WHEN mkt.ticker='MSFT' THEN 1 ELSE 0 END) AS "MSFT trades per trader",
        SUM(CASE WHEN mkt.ticker='AAPL' THEN 1 ELSE 0 END) AS "AAPL trades per trader",
        SUM(CASE WHEN mkt.ticker='YHOO' THEN 1 ELSE 0 END) AS "YHOO trades per trader"
      FROM MKTORDER mkt, (SELECT mkt2.trader,
                            COUNT(mkt2.ordersize) as TOTAL
                          FROM MKTORDER mkt2
                          WHERE mkt2.trader = mkt.trader
                          GROUP BY mkt2.trader 
                          ) tt
      GROUP BY mkt.trader
      ORDER BY mkt.trader ASC;
      
      
SELECT mkt2.trader,
        COUNT(mkt2.ordersize)
      FROM MKTORDEr mkt2
      GROUP BY mkt2.trader
      ORDER BY mkt2.trader ASC;
